---
import Layout from '../layouts/Layout.astro';
import Header from '../components/astro/Header.astro';
import { MovieGrid } from '../components/react/MovieGrid.tsx';
import { tmdbService } from '../services/tmdbService';
import '../styles/cartelera.css';

// Obtener películas en cartelera
const nowPlayingResponse = await tmdbService.getNowPlayingMovies();
const nowPlayingMovies = nowPlayingResponse.results;

const upcomingPages = [1, 2, 3];
const upcomingPromises = upcomingPages.map(page => tmdbService.getUpcomingMovies(page));
const upcomingResponses = await Promise.all(upcomingPromises);
const allUpcomingMovies = upcomingResponses.flatMap(response => response.results);

const today = new Date();
today.setHours(0, 0, 0, 0);

const futureMovies = allUpcomingMovies.filter(movie => {
  const releaseDate = new Date(movie.release_date);
  return releaseDate >= today;
});
---

<Layout title="Cartelera - CineVerse">
  <Header />
  <main class="cartelera">
    <div class="container">
      <header class="cartelera-header">
        <h1>Cartelera</h1>
        <div class="filters">
          <select class="filter-select">
            <option>Todas las películas</option>
            <option>Acción</option>
            <option>Comedia</option>
            <option>Drama</option>
            <option>Terror</option>
          </select>
          <select class="filter-select">
            <option>Todos los formatos</option>
            <option>2D</option>
            <option>3D</option>
          </select>
        </div>
      </header>

      <!-- En Cartelera -->
      <section class="movie-section">
        <h2>En Cartelera</h2>
        <MovieGrid movies={nowPlayingMovies} client:load />
      </section>

      <!-- Próximos Estrenos -->
      <section class="movie-section">
        <h2>Próximos Estrenos</h2>
        <MovieGrid movies={futureMovies} client:load />
      </section>
    </div>
  </main>
</Layout>
