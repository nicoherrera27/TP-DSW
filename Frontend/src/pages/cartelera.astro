---
import Layout from '../layouts/Layout.astro';
import Header from '../components/astro/Header.astro';
import { MovieGrid } from '../components/react/MovieGrid.tsx';
import '../styles/cartelera.css';

// 1. Fetch de las películas desde TU backend
const response = await fetch('http://localhost:3000/api/movies');
const localMoviesData = await response.json();

// 2. Mapear los datos de tu backend al formato que espera MovieGrid
//    Tu API devuelve { message: '...', data: [...] }
const moviesFromDB = localMoviesData.data.map((movie: any) => ({
  id: movie.tmdbId || movie.id, // Usamos tmdbId para enlazar a la página de detalle existente
  title: movie.name,
  overview: movie.synopsis,
  poster_path: movie.url,
}));
---

<Layout title="Cartelera - CineVerse">
  <Header />
  <main class="cartelera">
    <div class="container">
      <header class="cartelera-header">
        <h1>Nuestra Cartelera</h1>
        <div class="filters">
          {
            /* Los filtros se mantienen por ahora, pero su lógica necesitaría conectarse */
          }
          <select class="filter-select">
            <option>Todas las películas</option>
          </select>
        </div>
      </header>

      <section class="movie-section">
        <MovieGrid movies={moviesFromDB} client:load />
      </section>

      {
        /* Por ahora, hemos quitado la sección de "Próximos Estrenos" para simplificar
          y mostrar solo lo que tienes en tu base de datos. */
      }
    </div>
  </main>
</Layout>
