---
import Layout from '../layouts/Layout.astro';
import { MovieGrid } from '../components/react/MovieGrid.tsx';
import '../styles/movie-detail.css';
import '../styles/cartelera.css';

let moviesForGrid: any[] = [];
try {
  const response = await fetch('http://127.0.0.1:3000/api/show/specials');
  if (response.ok) {
    const json = await response.json();
    const specialShows = json.data || [];
    if (specialShows && Array.isArray(specialShows)) {
      moviesForGrid = specialShows
        .filter((show) => show && show.showMovie && show.showMovie.tmdbId)
        .map((show) => ({
          id: show.showMovie.tmdbId,
          title: show.showMovie.name,
          overview: show.showMovie.synopsis,
          poster_path: show.showMovie.url,
          release_date: '',
          vote_average: 0,
        }));
    }
  } else {
    throw new Error('Server error while fetching special shows.');
  }
} catch (error) {
  throw new Error('Connection error');
}
---

<Layout title="CineVerse - Special Shows">
  <main class="cartelera">
    <div class="container">
      <header class="cartelera-header">
        <h1>Special Shows</h1>

        <p class="page-subtitle">
          Unique events and legendary screenings you can't miss.
        </p>
      </header>
      <section class="movie-section">
        {
          moviesForGrid.length > 0 ? (
            <MovieGrid movies={moviesForGrid} basePath="/movie" client:load />
          ) : (
            <p class="no-movies-message">
              No special shows are available at the moment.
            </p>
          )
        }
      </section>
    </div>
  </main>
</Layout>

<style>
  .page-subtitle {
    font-size: 1.2rem;
    color: #333;
    margin-top: -1rem;
    margin-bottom: 2rem;
  }
  .no-movies-message {
    color: #333;
    text-align: center;
    padding: 2rem;
    font-size: 1.1rem;
  }
</style>
