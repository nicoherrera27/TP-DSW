---
import Layout from '../layouts/Layout.astro';
import Header from '../components/astro/Header.astro';
import Footer from '../components/astro/Footer.astro';
import { MovieGrid } from '../components/react/MovieGrid.tsx';
import '../styles/movie-detail.css';
import '../styles/cartelera.css';

let moviesForGrid: any[] = [];
try {
  const response = await fetch('http://127.0.0.1:3000/api/show/specials');
  if (response.ok) {
    const json = await response.json();
    const specialShows = json.data || [];
    if (specialShows && Array.isArray(specialShows)) {
      moviesForGrid = specialShows
        .filter((show) => show && show.showMovie && show.showMovie.tmdbId)
        .map((show) => ({
          id: show.showMovie.tmdbId,
          title: show.showMovie.name,
          overview: show.showMovie.synopsis,
          poster_path: show.showMovie.url,
          release_date: '',
          vote_average: 0,
        }));
    }
  } else {
    console.error('Error del servidor:', await response.text());
  }
} catch (error) {
  console.error('Error de conexión:', error);
}
---

<Layout title="Funciones Especiales - CineVerse">
  <Header />
  {/* 2. Usamos la misma estructura y clases que en cartelera.astro */}
  <main class="cartelera">
    <div class="container">
      <header class="cartelera-header">
        <h1>Funciones Especiales</h1>
        {/* 3. Agregamos el subtítulo que pediste */}
        <p class="page-subtitle">
          Eventos únicos y proyecciones míticas que no te podés perder.
        </p>
      </header>
      <section class="movie-section">
        {
          moviesForGrid.length > 0 ? (
            <MovieGrid movies={moviesForGrid} basePath="/movie" client:load />
          ) : (
            <p class="no-movies-message">
              No hay funciones especiales disponibles en este momento.
            </p>
          )
        }
      </section>
    </div>
  </main>
  <Footer />
</Layout>

{/* 4. Estilos específicos para el subtítulo y el mensaje */}
<style>
  .page-subtitle {
    font-size: 1.2rem;
    color: #333; /* Color de texto oscuro */
    margin-top: -1rem;
    margin-bottom: 2rem;
  }
  .no-movies-message {
    color: #333; /* Color de texto oscuro */
    text-align: center;
    padding: 2rem;
    font-size: 1.1rem;
  }
</style>