---
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/astro/Header.astro';


export const prerender = false;

const { id } = Astro.params;

if (!id) {
  return Astro.redirect('/404');
}

// Hacemos la llamada al backend para obtener los datos de la función
const response = await fetch(`http://localhost:3000/api/show/${id}`);
const json = await response.json();
const show = json.data;

// Si no encuentra la función, redirige a 404
if (!show) {
  return Astro.redirect('/404');
}

// Extraemos la información de la película desde la propiedad anidada "showMovie"
const movie = show.showMovie;
const posterUrl = movie.url;
---

<Layout title={movie.name}>
  <Header />
  {/* El contenedor principal ahora es blanco y tiene sombra */}
  <main class="movie-detail-container">
    <div class="detail-grid">
      <div class="main-content">
        <h1>{movie.name}</h1>
        <div class="meta-info">
          <span>{movie.duration} min</span>
          <span>•</span>
          <span>Función Especial</span>
        </div>
        <p class="synopsis">{movie.synopsis}</p>

        {/* Podrías agregar un trailer aquí si tuvieras el dato en el backend */}
      </div>

      <aside class="sidebar-content">
        <img src={posterUrl} alt={`Póster de ${movie.name}`} class="detail-poster" />
        <div class="data-sheet">
          <h4>Detalles del Evento</h4>
          <ul>
            <li><strong>Película:</strong> {movie.name}</li>
            <li><strong>Fecha del evento:</strong> {show.date}</li>
            <li><strong>Duración:</strong> {movie.duration} min</li>
          </ul>
        </div>
      </aside>
    </div>
  </main>
</Layout>